const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/rewardsService-CcLMzwY8.js","assets/js/index-C4myuZdd.js","assets/js/vendor-ui-S1-b02vM.js","assets/js/vendor-react-7PqXWhc5.js","assets/js/vendor-utils-Drrw94dm.js","assets/js/vendor-supabase-DCWnlmhc.js","assets/js/vendor-animation-BozBRtxF.js","assets/css/index-Ds2L_J4X.css"])))=>i.map(i=>d[i]);
import{r as c,j as e}from"./vendor-ui-S1-b02vM.js";import{c as A,y as d,_ as q,u as C,t as l,C as b,f as v,B as f,A as F,m as D,h as I}from"./index-C4myuZdd.js";import{M as z,N as B}from"./useTrips-BBJaC5In.js";import{S as $}from"./ServiceTabs-Dqf6iUZr.js";import{S as m}from"./serviceFactory-BhemUNoC.js";import{B as j}from"./bike-Da2nunz2.js";import{Z as O}from"./zap-aZRjv3J1.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-Drrw94dm.js";import"./vendor-supabase-DCWnlmhc.js";import"./vendor-animation-BozBRtxF.js";import"./tabs-B9Xs08FN.js";import"./PackageDelivery-3jNL1jY6.js";import"./input-B6A87FZ6.js";import"./label-BRQac6GQ.js";import"./radio-group-ClA2Gy1y.js";import"./ImageWithFallback-Bl_nuHch.js";import"./locate-vTgYpdHc.js";import"./truck-Dw4hNZ1M.js";import"./calendar-clock-DRJnYAdV.js";import"./scan-search-CjUklhdJ.js";import"./circle-dollar-sign-CSf7pR0F.js";import"./shield-CJP27Qcy.js";import"./FindRide-Dj0T_7Vv.js";import"./switch-d-2WclGi.js";import"./dialog-y1zr9Dfl.js";import"./avatar-BeTgQo5q.js";import"./sparkles-CNaXPMKw.js";import"./smartphone-BQgG8q0v.js";import"./timer-C9OLMlzC.js";import"./users-round-6idvwZaa.js";import"./useBookings-DDDAlem2.js";import"./move-right-xBcSULm3.js";import"./OfferRide-D9KUq6lo.js";import"./textarea-Q3a7MXEa.js";import"./circle-plus-1J_Ux_O9.js";import"./radar-BFej6-JE.js";import"./user-plus-DBHyUMjB.js";import"./thermometer-sun-Doqsn75-.js";import"./leaf-DNscW6R4.js";import"./car-B3BmIsNb.js";import"./search-Da8amzCi.js";import"./users-BYsldg1t.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],_=A("scan",U);class W{async getNearbyScooters(s,a,t=2){const n=await m.discover("scooter",{lat:s,lng:a,radius:t,minBattery:20});return!n.success||!n.data||n.data.length===0?this.getMockScooters(s,a):n.data.map(o=>({id:o.id,code:o.code,battery:o.battery,range:o.range_km||o.range||0,lat:o.lat||(o.location?this.extractLat(o.location):0),lng:o.lng||(o.location?this.extractLng(o.location):0),pricePerMin:o.price_per_min||o.pricePerMin||1,status:o.status}))}extractLat(s){return typeof s=="string"&&s.startsWith("POINT")?parseFloat(s.split("(")[1].split(")")[0].split(" ")[1]):0}extractLng(s){return typeof s=="string"&&s.startsWith("POINT")?parseFloat(s.split("(")[1].split(")")[0].split(" ")[0]):0}async unlockScooter(s){const a=await m.request({type:"scooter",details:{scooterId:s}});if(!a.success)throw new Error(a.error||"Failed to create rental");const t=a.data;return await m.assign("scooter",t.id),await m.start("scooter",t.id),await d.from("scooters").update({status:"in-use"}).eq("id",s),t}async endRide(s,a){const{data:t,error:n}=await d.from("scooter_rentals").select("*, scooter:scooter_id(*)").eq("id",s).single();if(n||!t)throw new Error("Rental not found");const o=new Date(t.start_time).getTime(),p=Date.now(),i=Math.ceil((p-o)/(1e3*60)),u=(await m.calculatePrice("scooter",{durationMinutes:i,pricePerMin:t.scooter.price_per_min})).data?.totalPrice||0,x=await m.complete("scooter",s,{end_time:new Date().toISOString(),end_location:`POINT(${a.lng} ${a.lat})`,duration_minutes:i,total_cost:u});await d.from("scooters").update({status:"available",location:`POINT(${a.lng} ${a.lat})`}).eq("id",t.scooter_id);try{if(t&&t.user_id){const{rewardsService:h}=await q(async()=>{const{rewardsService:g}=await import("./rewardsService-CcLMzwY8.js");return{rewardsService:g}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await h.processTripRewards(t.user_id,"scooter",i*.25)}}catch(h){console.warn("Failed to process rewards:",h)}return{rental:x.data,cost:u}}async getUserRentals(s){const{data:a,error:t}=await d.from("scooter_rentals").select("*, scooter:scooter_id(*)").eq("user_id",s).order("start_time",{ascending:!1});if(t)throw t;return a||[]}async getActiveRental(s){const{data:a,error:t}=await d.from("scooter_rentals").select("*, scooter:scooter_id(*)").eq("user_id",s).eq("status","active").single();if(t&&t.code!=="PGRST116")throw t;return a||null}async reportIssue(s,a){await d.from("scooters").update({status:"maintenance",notes:a}).eq("id",s)}getMockScooters(s,a){return[{id:"1",code:"WAS-001",battery:85,range:25,lat:s+.001,lng:a+.001,pricePerMin:1,status:"available"},{id:"2",code:"WAS-002",battery:42,range:12,lat:s-8e-4,lng:a+7e-4,pricePerMin:1,status:"available"},{id:"3",code:"WAS-003",battery:15,range:4,lat:s+7e-4,lng:a+.0012,pricePerMin:1,status:"low-battery"},{id:"4",code:"WAS-004",battery:92,range:28,lat:s-.0013,lng:a-5e-4,pricePerMin:1,status:"available"}]}}const N=new W;function qe(){const{user:S}=C(),[s,a]=c.useState([]),[t,n]=c.useState(null),[o,p]=c.useState(!1),[i,y]=c.useState(null),[u,x]=c.useState(0),[h,g]=c.useState(!0);c.useEffect(()=>{w()},[]);const w=async()=>{try{g(!0);const r=await N.getNearbyScooters(25.2048,55.2708,3);a(r)}catch(r){console.error("Failed to load scooters:",r),l.error("Failed to load scooters")}finally{g(!1)}};c.useEffect(()=>{let r;return i&&(r=setInterval(()=>{x(Math.floor((Date.now()-i.startTime)/1e3))},1e3)),()=>clearInterval(r)},[i]);const k=async()=>{if(!t||!S){l.error("Please sign in to rent a scooter");return}p(!0);try{const r=await N.unlockScooter(t.id);y({rental:r,startTime:Date.now(),scooter:t}),l.success("Scooter unlocked! Enjoy your ride."),n(null),w()}catch(r){l.error(r.message||"Failed to unlock scooter")}finally{p(!1)}},R=async()=>{if(i)try{const{cost:r}=await N.endRide(i.rental.id,{lat:25.2048,lng:55.2708});l.success(`Ride ended. Total: AED ${r.toFixed(2)}. Payment processed.`),y(null),x(0),w()}catch(r){l.error(r.message||"Failed to end ride")}},P=r=>{const T=Math.floor(r/60),E=r%60;return`${T}:${E.toString().padStart(2,"0")}`},M=e.jsxs("div",{className:"h-[calc(100vh-80px)] flex flex-col relative bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"flex-1 relative z-0",children:e.jsx(z,{className:"w-full h-full",locations:s.map(r=>({lat:r.lat,lng:r.lng,label:r.code,type:"scooter",data:r})),onLocationClick:r=>n(r.data)})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex justify-between pointer-events-none",children:[e.jsx(b,{className:"pointer-events-auto bg-white/90 backdrop-blur-md shadow-lg border-0",children:e.jsxs(v,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(j,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:"Nearby Scooters"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.filter(r=>r.status==="available").length," available"]})]})]})}),i&&e.jsx(b,{className:"pointer-events-auto bg-green-600 text-white shadow-lg border-0 animate-pulse",children:e.jsxs(v,{className:"p-4 flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-100 uppercase font-bold",children:"Ride Time"}),e.jsx("p",{className:"font-mono text-2xl font-bold",children:P(u)})]}),e.jsx(f,{variant:"secondary",size:"sm",onClick:R,className:"bg-white text-green-700 hover:bg-green-50",children:"End Ride"})]})})]}),e.jsx(F,{children:t&&!i&&e.jsx(D.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"absolute bottom-4 left-4 right-4 z-20",children:e.jsx(b,{className:"bg-white/95 backdrop-blur-xl shadow-2xl border-0",children:e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[t.code,e.jsxs(I,{variant:t.battery>20?"default":"destructive",className:"text-xs",children:[t.battery,"% Battery"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"})," ",t.range,"km range"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"})," Electronic"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["AED ",t.pricePerMin]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"per min"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{className:"flex-1 h-12 text-lg bg-green-600 hover:bg-green-700",onClick:k,disabled:o||t.status==="low-battery",children:o?e.jsx("span",{className:"animate-pulse",children:"Unlocking..."}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 w-5 h-5"}),t.status==="low-battery"?"Low Battery":"Scan to Unlock"]})}),e.jsx(f,{variant:"outline",className:"h-12 aspect-square",onClick:()=>n(null),children:"X"})]})]})})})}),!t&&!i&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-10",children:e.jsxs(f,{size:"lg",className:"h-16 rounded-full px-8 shadow-2xl bg-gradient-to-r from-green-500 to-emerald-600 hover:scale-105 transition-transform",onClick:()=>l.info("Point camera at scooter QR code"),children:[e.jsx(_,{className:"mr-2 w-6 h-6"}),"Scan to Ride"]})})]});return e.jsx($,{mainService:M,mainServiceTitle:"Scooter Rentals",mainServiceIcon:e.jsx(j,{className:"w-4 h-4"}),showAllTabs:!0})}export{qe as ScooterRentals};
