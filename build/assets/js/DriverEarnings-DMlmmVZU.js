const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/jspdf.es.min-Ba5leFK4.js","assets/js/index-CcjVERrS.js","assets/js/vendor-ui-Cj-e85pn.js","assets/js/vendor-react-7PqXWhc5.js","assets/js/vendor-utils-MHJ_mICC.js","assets/js/vendor-supabase-BfzcFBqZ.js","assets/js/vendor-animation-BozBRtxF.js","assets/css/index-CBL1fn7d.css"])))=>i.map(i=>d[i]);
import{u as P,n as T,B as p,D as F,C as r,a as i,b as l,e as o,f,d as h,P as u,g as B,t as m,_ as b}from"./index-CcjVERrS.js";import{r as j,j as e}from"./vendor-ui-Cj-e85pn.js";import{T as R,a as S,b as g,c as _}from"./tabs-D2UP-FqT.js";import{A as M,a as L}from"./arrow-up-right-DXf0MoBQ.js";import{S as O}from"./star-CQ2TaMcM.js";import{A as $}from"./award-DmioZ8Us.js";import{T as W}from"./target-C8F9ucPk.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-MHJ_mICC.js";import"./vendor-supabase-BfzcFBqZ.js";import"./vendor-animation-BozBRtxF.js";function ee(){const{user:x}=P(),{t:H,language:I}=T(),[n,v]=j.useState("today"),[s,E]=j.useState(null),[k,y]=j.useState(!0);j.useEffect(()=>{N()},[x]);const N=async()=>{y(!0);try{const a={todayEarnings:245.5,weekEarnings:1450.75,monthEarnings:5890.25,totalEarnings:28450.8,fareBreakdown:{totalFares:1650.75,platformFee:330.15,netEarnings:1320.6,tips:95.5,bonuses:34.65,incentives:0},payout:{availableBalance:1450.75,pendingBalance:245.5,nextPayoutDate:new Date(Date.now()+2592e5),payoutMethod:"bank_transfer"},performance:{tripsCompleted:47,hoursOnline:32.5,averageRating:4.8,acceptanceRate:92,cancellationRate:3,earningsPerHour:44.64},weeklyComparison:{tripsChange:12,earningsChange:8.5,ratingChange:.2}};E(a)}catch(a){console.error("Failed to load earnings:",a)}finally{y(!1)}},D=async()=>{if(!(!s||!x))try{const{paymentService:a}=await b(async()=>{const{paymentService:t}=await import("./integrations-CUA0pWDL.js");return{paymentService:t}},[]),c=await fetch("/api/payments/create-payout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x.id,amount:s.payout.availableBalance,currency:"AED"})});if(c.ok){const t=await c.json();m.success(`Payout of AED ${s.payout.availableBalance} initiated. Funds will be transferred within 1-2 business days.`),N()}else{const t=await c.json();m.error(t.message||"Failed to initiate payout")}}catch(a){console.error("Payout failed:",a),m.error("Failed to initiate payout. Please try again later.")}},C=async()=>{if(!(!s||!x))try{const a=await fetch(`/api/earnings/statement?userId=${x.id}&period=${n}`,{method:"GET"});if(a.ok){const c=await a.blob(),t=window.URL.createObjectURL(c),d=document.createElement("a");d.href=t,d.download=`wassel-earnings-statement-${n}-${Date.now()}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(t),m.success("Statement downloaded successfully")}else{const{jsPDF:c}=await b(async()=>{const{jsPDF:d}=await import("./jspdf.es.min-Ba5leFK4.js").then(A=>A.j);return{jsPDF:d}},__vite__mapDeps([0,1,2,3,4,5,6,7])),t=new c;t.text("Wassel Earnings Statement",20,20),t.text(`Period: ${n}`,20,30),t.text(`Total Earnings: AED ${s.payout.availableBalance.toFixed(2)}`,20,40),t.text(`Trips Completed: ${s.performance.tripsCompleted}`,20,50),t.save(`wassel-earnings-${n}-${Date.now()}.pdf`),m.success("Statement generated and downloaded")}}catch(a){console.error("Statement generation failed:",a),m.error("Failed to generate statement")}};if(k||!s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const w={today:s.todayEarnings,week:s.weekEarnings,month:s.monthEarnings}[n];return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Earnings"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your income and performance"})]}),e.jsxs(p,{onClick:C,variant:"outline",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Download Statement"]})]}),e.jsxs(R,{value:n,onValueChange:a=>v(a),children:[e.jsxs(S,{children:[e.jsx(g,{value:"today",children:"Today"}),e.jsx(g,{value:"week",children:"This Week"}),e.jsx(g,{value:"month",children:"This Month"})]}),e.jsxs(_,{value:n,className:"space-y-6 mt-6",children:[e.jsxs(r,{className:"bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx(i,{children:e.jsxs(l,{className:"text-white",children:[n==="today"&&"Today's Earnings",n==="week"&&"This Week's Earnings",n==="month"&&"This Month's Earnings"]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["AED ",w.toFixed(2)]}),n==="week"&&e.jsxs(f,{variant:s.weeklyComparison.earningsChange>=0?"default":"destructive",className:"ml-2",children:[s.weeklyComparison.earningsChange>=0?e.jsx(M,{className:"w-3 h-3 mr-1"}):e.jsx(L,{className:"w-3 h-3 mr-1"}),Math.abs(s.weeklyComparison.earningsChange),"%"]})]}),e.jsxs("p",{className:"mt-2 opacity-90",children:["From ",s.performance.tripsCompleted," trips"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium",children:"Available Balance"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["AED ",s.payout.availableBalance.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ready for payout"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium",children:"Pending Balance"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["AED ",s.payout.pendingBalance.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Processing"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium",children:"Earnings/Hour"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["AED ",s.performance.earningsPerHour.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average rate"})]})]}),e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium",children:"Hours Online"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.performance.hoursOnline.toFixed(1),"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"This week"})]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Earnings Breakdown"}),e.jsx(h,{children:"Detailed breakdown of your income"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Fares"}),e.jsxs("span",{className:"font-semibold",children:["AED ",s.fareBreakdown.totalFares.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-red-600",children:[e.jsx("span",{children:"Platform Fee (20%)"}),e.jsxs("span",{children:["- AED ",s.fareBreakdown.platformFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Net Earnings"}),e.jsxs("span",{className:"font-semibold",children:["AED ",s.fareBreakdown.netEarnings.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-green-600",children:[e.jsx("span",{children:"Tips"}),e.jsxs("span",{children:["+ AED ",s.fareBreakdown.tips.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-green-600",children:[e.jsx("span",{children:"Bonuses"}),e.jsxs("span",{children:["+ AED ",s.fareBreakdown.bonuses.toFixed(2)]})]}),e.jsxs("div",{className:"border-t pt-4 flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-lg",children:"Total Earnings"}),e.jsxs("span",{className:"font-bold text-xl",children:["AED ",w.toFixed(2)]})]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Performance Metrics"}),e.jsx(h,{children:"Your driver performance this week"})]}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Acceptance Rate"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.performance.acceptanceRate,"%"]})]}),e.jsx(u,{value:s.performance.acceptanceRate}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Target: 90% or higher"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Average Rating"}),e.jsxs("span",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),s.performance.averageRating.toFixed(1)]})]}),e.jsx(u,{value:s.performance.averageRating*20}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Based on ",s.performance.tripsCompleted," ratings"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Cancellation Rate"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.performance.cancellationRate,"%"]})]}),e.jsx(u,{value:s.performance.cancellationRate*20,className:"[&>div]:bg-red-500"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Target: Below 5%"})]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Payout Information"}),e.jsx(h,{children:"Manage your payment settings"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Available for Payout"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["AED ",s.payout.availableBalance.toFixed(2)]}),s.payout.nextPayoutDate&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Next automatic payout on"," ",s.payout.nextPayoutDate.toLocaleDateString()]})]}),e.jsxs(p,{onClick:D,size:"lg",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Cash Out"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payout Method"}),e.jsx("span",{className:"font-medium",children:s.payout.payoutMethod==="bank_transfer"?"Bank Transfer":"Wassel Wallet"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Processing Time"}),e.jsx("span",{className:"font-medium",children:"1-2 business days"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Minimum Payout"}),e.jsx("span",{className:"font-medium",children:"AED 50.00"})]})]}),e.jsx(p,{variant:"outline",className:"w-full",children:"Change Payout Method"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Active Incentives"}),e.jsx(h,{children:"Earn more with these bonuses"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-semibold",children:"Weekend Warrior"})]}),e.jsx(f,{children:"+20% Earnings"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Complete 15 trips this weekend"}),e.jsx(u,{value:60}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"9/15 trips completed"})]}),e.jsxs("div",{className:"p-4 border rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-semibold",children:"Peak Hours Bonus"})]}),e.jsx(f,{children:"+AED 5/trip"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drive during peak hours (7-9 AM, 5-7 PM)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active until end of month"})]})]})]})]})]})]})}export{ee as DriverEarnings};
