import{r as u,j as e}from"./vendor-ui-S1-b02vM.js";import{y as c,u as $,m as j,C as w,f as S,b as B,d as M,e as E,B as v,t as f}from"./index-C4myuZdd.js";import{I as g}from"./input-B6A87FZ6.js";import{L as h}from"./label-BRQac6GQ.js";import{S as J,a as K,b as Q,c as X,d as Y}from"./select-Dbr-udHW.js";import{C as Z}from"./OfferRide-D9KUq6lo.js";import{I as ee}from"./ImageWithFallback-Bl_nuHch.js";import{S as se}from"./ServiceTabs-Dqf6iUZr.js";import{S as L}from"./serviceFactory-BhemUNoC.js";import{S as b}from"./school-DxD3fG9K.js";import{S as ae}from"./shield-CJP27Qcy.js";import{B as te}from"./bell-Dmyk4tvG.js";import{M as D}from"./map-pin-Df2cP3Jg.js";import{U as re}from"./users-BYsldg1t.js";import{C as ie}from"./calendar-CXffNcfQ.js";import{C as O}from"./clock-DfBHxk1w.js";import{U as oe}from"./user-Crd6ZvF6.js";import{C as le}from"./circle-check-big-DXrMOBon.js";import{C as ne}from"./circle-alert-X1n1Irhl.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-Drrw94dm.js";import"./vendor-supabase-DCWnlmhc.js";import"./vendor-animation-BozBRtxF.js";import"./textarea-Q3a7MXEa.js";import"./radio-group-ClA2Gy1y.js";import"./switch-d-2WclGi.js";import"./useTrips-BBJaC5In.js";import"./locate-vTgYpdHc.js";import"./circle-plus-1J_Ux_O9.js";import"./radar-BFej6-JE.js";import"./calendar-clock-DRJnYAdV.js";import"./timer-C9OLMlzC.js";import"./users-round-6idvwZaa.js";import"./circle-dollar-sign-CSf7pR0F.js";import"./truck-Dw4hNZ1M.js";import"./tabs-B9Xs08FN.js";import"./PackageDelivery-3jNL1jY6.js";import"./scan-search-CjUklhdJ.js";import"./FindRide-Dj0T_7Vv.js";import"./dialog-y1zr9Dfl.js";import"./avatar-BeTgQo5q.js";import"./sparkles-CNaXPMKw.js";import"./smartphone-BQgG8q0v.js";import"./useBookings-DDDAlem2.js";import"./move-right-xBcSULm3.js";import"./zap-aZRjv3J1.js";import"./user-plus-DBHyUMjB.js";import"./thermometer-sun-Doqsn75-.js";import"./leaf-DNscW6R4.js";import"./car-B3BmIsNb.js";import"./bike-Da2nunz2.js";import"./search-Da8amzCi.js";class ce{async createRoute(s){const r=(await L.calculatePrice("school",{students:s.students.length,days:s.activeDays})).data?.monthlyTotal||0,o=await L.request({type:"school",from:{lat:s.pickupLat,lng:s.pickupLng,address:s.pickupLocation},to:{lat:s.schoolLat,lng:s.schoolLng,address:s.schoolLocation},time:s.pickupTime,details:{pickup_location:s.pickupLocation,school_location:s.schoolLocation,pickup_time:s.pickupTime,return_time:s.returnTime,active_days:s.activeDays,trip_type:s.tripType,monthly_price:r}});if(!o.success)throw new Error(o.error||"Failed to create school route");const i=o.data,m=await Promise.all(s.students.map(d=>this.addStudent(i.id,d)));return await this.createRecurringTrips(i),{route:i,students:m}}async addStudent(s,t){const{data:r,error:o}=await c.from("school_students").insert({route_id:s,name:t.name,age:t.age,grade:t.grade,guardians:t.guardians}).select().single();if(o)throw o;return r}async removeStudent(s){const{error:t}=await c.from("school_students").delete().eq("id",s);if(t)throw t}async getRoute(s){const{data:t,error:r}=await c.from("school_routes").select("*").eq("id",s).single();if(r)throw r;const{data:o,error:i}=await c.from("school_students").select("*").eq("route_id",s);if(i)throw i;return{...t,students:o||[]}}async getUserRoutes(s){const{data:t,error:r}=await c.from("school_routes").select("*").eq("created_by",s).order("created_at",{ascending:!1});if(r)throw r;return t||[]}async getUpcomingTrips(s,t=7){const r=new Date;r.setDate(r.getDate()+t);const{data:o,error:i}=await c.from("school_trips").select(`
        *,
        driver:assigned_driver_id(full_name, phone_number, rating)
      `).eq("route_id",s).gte("trip_date",new Date().toISOString().split("T")[0]).lte("trip_date",r.toISOString().split("T")[0]).order("trip_date",{ascending:!0});if(i)throw i;return o||[]}async checkInStudent(s,t){const{data:r,error:o}=await c.from("school_trips").select("students_checked_in").eq("id",s).single();if(o)throw o;const i=r.students_checked_in||[];i.includes(t)||i.push(t);const{data:m,error:d}=await c.from("school_trips").update({students_checked_in:i,status:"active"}).eq("id",s).select().single();if(d)throw d;return m}async checkOutStudent(s,t){const{data:r,error:o}=await c.from("school_trips").select("students_checked_out").eq("id",s).single();if(o)throw o;const i=r.students_checked_out||[];i.includes(t)||i.push(t);const{data:m,error:d}=await c.from("school_trips").update({students_checked_out:i}).eq("id",s).select().single();if(d)throw d;const{data:y}=await c.from("school_students").select("id").eq("route_id",r.route_id);return y&&i.length===y.length&&await L.complete("school",s),m}async pauseRoute(s){const{error:t}=await c.from("school_routes").update({status:"paused"}).eq("id",s);if(t)throw t;await c.from("school_trips").update({status:"cancelled"}).eq("route_id",s).gt("trip_date",new Date().toISOString().split("T")[0]).eq("status","scheduled")}async resumeRoute(s){const{error:t}=await c.from("school_routes").update({status:"active"}).eq("id",s);if(t)throw t;const{data:r}=await c.from("school_routes").select("*").eq("id",s).single();r&&await this.createRecurringTrips(r)}async notifyGuardians(s,t,r){const{data:o}=await c.from("school_students").select("guardians").eq("route_id",s);if(!o)return;const i=o.flatMap(m=>m.guardians.map(d=>d.phone)).filter(Boolean);console.log("Notifying guardians:",i,t)}async createRecurringTrips(s){const t=[],r=new Date,o=new Date;o.setMonth(o.getMonth()+1);for(let i=new Date(r);i<=o;i.setDate(i.getDate()+1)){const m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][i.getDay()];s.active_days.includes(m)&&t.push({route_id:s.id,trip_date:i.toISOString().split("T")[0],status:"scheduled",students_checked_in:[],students_checked_out:[]})}t.length>0&&await c.from("school_trips").insert(t)}}const de=new ce;function cs(){const{user:R}=$(),[s,t]=u.useState("round-trip"),[r,o]=u.useState([]),[i,m]=u.useState(!1),[d,y]=u.useState(""),[k,q]=u.useState(""),[_,A]=u.useState(""),[F,P]=u.useState(""),[N,G]=u.useState([]),[n,x]=u.useState({guardians:[]}),I=["Monday","Tuesday","Wednesday","Thursday","Friday"],z=a=>{G(l=>l.includes(a)?l.filter(p=>p!==a):[...l,a])},U=()=>{n.name&&n.age&&n.grade?(o([...r,n]),x({guardians:[]}),f.success("Student added successfully")):f.error("Please fill in all student details")},V=()=>{if(n.guardians){const a={name:"",relationship:"",phone:""};x({...n,guardians:[...n.guardians,a]})}},T=(a,l,p)=>{if(n.guardians){const C=[...n.guardians];C[a]={...C[a],[l]:p},x({...n,guardians:C})}},W=async()=>{if(!R){f.error("Please sign in to book school transport");return}if(!r.length||!d||!k||!_||!N.length){f.error("Please fill in all required fields");return}m(!0);try{const{route:a}=await de.createRoute({pickupLocation:d,pickupLat:25.1161,pickupLng:55.1964,schoolLocation:k,schoolLat:25.2345,schoolLng:55.3456,pickupTime:_,returnTime:F,activeDays:N,students:r,tripType:s});f.success(`School transport route created! Monthly trips scheduled for ${N.length} days.`),o([]),y(""),q(""),A(""),P(""),G([]),x({guardians:[]})}catch(a){f.error(a.message||"Failed to book school transport")}finally{m(!1)}},H=e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-600 p-8 md:p-12 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",children:e.jsx(ee,{src:"https://images.unsplash.com/photo-1685645647479-a0232f3fec6d",alt:"School transport",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs(j.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2},className:"inline-flex items-center gap-3 bg-white/20 backdrop-blur-xl px-6 py-3 rounded-full mb-6",children:[e.jsx(b,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:"Safe School Transport"})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Safe & Reliable Student Transport"}),e.jsx("p",{className:"text-xl opacity-90 max-w-2xl",children:"Background-checked drivers, real-time tracking, and guardian notifications for complete peace of mind."})]}),e.jsx(j.div,{animate:{y:[0,-20,0],rotate:[0,5,-5,0]},transition:{duration:5,repeat:1/0},className:"absolute top-10 right-10 text-8xl opacity-30",children:"ðŸšŒ"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:ae,label:"Background Checks",color:"text-green-600"},{icon:te,label:"Live Notifications",color:"text-blue-600"},{icon:D,label:"Real-time Tracking",color:"text-purple-600"},{icon:re,label:"Guardian Verified",color:"text-orange-600"}].map((a,l)=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},children:e.jsx(w,{className:"border-2 hover:shadow-lg transition-all duration-300 hover:scale-105",children:e.jsxs(S,{className:"p-6 text-center",children:[e.jsx(a.icon,{className:`w-8 h-8 mx-auto mb-2 ${a.color}`}),e.jsx("p",{className:"text-sm font-medium",children:a.label})]})})},a.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{className:"border-2",children:[e.jsxs(B,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-amber-600"}),"Trip Details"]}),e.jsx(E,{children:"Configure your school transport schedule"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Trip Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(v,{variant:s==="one-way"?"default":"outline",onClick:()=>t("one-way"),className:"flex-1",children:"One-Way"}),e.jsx(v,{variant:s==="round-trip"?"default":"outline",onClick:()=>t("round-trip"),className:"flex-1",children:"Round-Trip"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"pickup",children:"Home/Pickup Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(g,{id:"pickup",placeholder:"Enter pickup address",value:d,onChange:a=>y(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"school",children:"School Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(g,{id:"school",placeholder:"Enter school address",value:k,onChange:a=>q(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"pickup-time",children:"Pickup Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(g,{id:"pickup-time",type:"time",value:_,onChange:a=>A(a.target.value),className:"pl-10"})]})]}),s==="round-trip"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"return-time",children:"Return Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(g,{id:"return-time",type:"time",value:F,onChange:a=>P(a.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Active Days"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:I.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:a,checked:N.includes(a),onCheckedChange:()=>z(a)}),e.jsx("label",{htmlFor:a,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:a.slice(0,3)})]},a))})]})]})]}),e.jsxs(w,{className:"border-2",children:[e.jsxs(B,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600"}),"Student & Guardian Information"]}),e.jsx(E,{children:"Add students and authorized guardians"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"student-name",children:"Student Name"}),e.jsx(g,{id:"student-name",placeholder:"Full name",value:n.name||"",onChange:a=>x({...n,name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"age",children:"Age"}),e.jsx(g,{id:"age",type:"number",placeholder:"Age",value:n.age||"",onChange:a=>x({...n,age:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"grade",children:"Grade"}),e.jsxs(J,{value:n.grade||"",onValueChange:a=>x({...n,grade:a}),children:[e.jsx(K,{id:"grade",children:e.jsx(Q,{placeholder:"Select"})}),e.jsx(X,{children:[...Array(12)].map((a,l)=>e.jsxs(Y,{value:`Grade ${l+1}`,children:["Grade ",l+1]},l+1))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Authorized Guardians"}),e.jsx(v,{variant:"outline",size:"sm",onClick:V,children:"+ Add Guardian"})]}),n.guardians?.map((a,l)=>e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(g,{placeholder:"Name",value:a.name,onChange:p=>T(l,"name",p.target.value)}),e.jsx(g,{placeholder:"Relationship",value:a.relationship,onChange:p=>T(l,"relationship",p.target.value)}),e.jsx(g,{placeholder:"Phone",value:a.phone,onChange:p=>T(l,"phone",p.target.value)})]},l))]}),e.jsx(v,{onClick:U,variant:"outline",className:"w-full",children:"Add Student to Booking"}),r.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{children:["Added Students (",r.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(le,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[a.age," yrs â€¢ ",a.grade," â€¢ ",a.guardians.length," guardian(s)"]})]})]},l))})]})]})]})]}),e.jsx(w,{className:"border-l-4 border-l-amber-500",children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Safety & Verification"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"â€¢ All drivers undergo comprehensive background checks and child safety training"}),e.jsx("li",{children:"â€¢ Real-time GPS tracking shared with all authorized guardians"}),e.jsx("li",{children:"â€¢ In-vehicle cameras for student safety (optional)"}),e.jsx("li",{children:"â€¢ Daily attendance reports sent via SMS and email"}),e.jsx("li",{children:"â€¢ Only authorized guardians can pick up students"})]})]})]})})}),e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(v,{onClick:W,className:"w-full h-14 text-lg bg-gradient-to-r from-yellow-500 via-amber-600 to-orange-600 hover:from-yellow-600 hover:via-amber-700 hover:to-orange-700 shadow-lg",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),"Book School Transport"]})})]});return e.jsx(se,{mainService:H,mainServiceTitle:"School Transport",mainServiceIcon:e.jsx(b,{className:"w-4 h-4"}),showAllTabs:!0})}export{cs as SchoolTransport};
