import{r as o,j as e}from"./vendor-ui-S1-b02vM.js";import{y as h,u as U,C as g,b as w,d as _,F as u,e as F,f as j,p,h as m,B as k,t as f}from"./index-C4myuZdd.js";import{I as v}from"./input-B6A87FZ6.js";import{L as d}from"./label-BRQac6GQ.js";import{S as G,R as O,a as S,I as A}from"./radio-group-ClA2Gy1y.js";import{I as Y}from"./ImageWithFallback-Bl_nuHch.js";import{S as b}from"./serviceFactory-BhemUNoC.js";import{L as y}from"./locate-vTgYpdHc.js";import{T as E}from"./truck-Dw4hNZ1M.js";import{C as B}from"./calendar-clock-DRJnYAdV.js";import{S as V}from"./scan-search-CjUklhdJ.js";import{C as X}from"./circle-dollar-sign-CSf7pR0F.js";import{S as $}from"./shield-CJP27Qcy.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-Drrw94dm.js";import"./vendor-supabase-DCWnlmhc.js";import"./vendor-animation-BozBRtxF.js";class J{async calculatePrice(a,s,t,l){const i=await b.calculatePrice("package",{packageSize:a,distanceKm:l});if(!i.success)throw new Error(i.error||"Failed to calculate price");return i.data}async findAvailableCaptains(a,s,t,l){const i=await b.discover("package",{from:a,to:s,date:l});return!i.success||!i.data||i.data.length===0?this.getMockCaptains(a,s):i.data.map(c=>({id:c.id,captain_id:c.driver_id,captain_name:c.driver?.full_name||"Captain",captain_rating:c.driver?.rating||4.5,captain_phone:c.driver?.phone_number||"",departure_time:c.departure_time,estimated_price:this.estimatePrice(t,c),trip_id:c.id,dropoff_type:"door-to-door"}))}async createDelivery(a){const s=await b.request({type:"package",from:{lat:a.fromLat,lng:a.fromLng,address:a.fromLocation},to:{lat:a.toLat,lng:a.toLng,address:a.toLocation},date:a.pickupDate,details:{package_size:a.packageSize,weight_kg:a.weight,description:a.description}});if(!s.success)throw new Error(s.error||"Failed to create delivery");return s.data}async assignCaptain(a,s,t){const{data:l,error:i}=await h.from("package_deliveries").update({captain_id:s,total_price:t,status:"assigned"}).eq("id",a).select().single();if(i)throw i;return l}async pickupPackage(a){const s=await b.start("package",a);if(!s.success)throw new Error(s.error||"Failed to update delivery");return await this.addTrackingUpdate(a,"picked-up","Package picked up by captain"),s.data}async deliverPackage(a,s){const t=await b.complete("package",a,{delivery_date:new Date().toISOString()});if(!t.success)throw new Error(t.error||"Failed to complete delivery");return await this.addTrackingUpdate(a,"delivered","Package delivered successfully",s),t.data}async getDeliveryByTrackingCode(a){const{data:s,error:t}=await h.from("package_deliveries").select(`
        *,
        sender:sender_id(full_name, phone_number),
        captain:captain_id(full_name, phone_number, rating)
      `).eq("tracking_code",a).single();if(t&&t.code!=="PGRST116")throw t;return s||null}async getUserDeliveries(a){const{data:s,error:t}=await h.from("package_deliveries").select(`
        *,
        captain:captain_id(full_name, phone_number, rating)
      `).eq("sender_id",a).order("created_at",{ascending:!1});if(t)throw t;return s||[]}async getTrackingHistory(a){const{data:s,error:t}=await h.from("package_tracking").select("*").eq("delivery_id",a).order("timestamp",{ascending:!0});if(t)throw t;return s||[]}async addTrackingUpdate(a,s,t,l){await h.from("package_tracking").insert({delivery_id:a,timestamp:new Date().toISOString(),status:s,notes:t,location:l?`POINT(${l.lng} ${l.lat})`:null})}estimatePrice(a,s){return{small:15,medium:35,large:60}[a]||35}getMockCaptains(a,s){return[{id:"1",captain_id:"captain-1",captain_name:"Ahmed K.",captain_rating:4.9,captain_phone:"+971501234567",departure_time:"14:00",estimated_price:35,trip_id:"trip-1",dropoff_type:"door-to-door"},{id:"2",captain_id:"captain-2",captain_name:"Sarah M.",captain_rating:4.8,captain_phone:"+971507654321",departure_time:"15:30",estimated_price:25,trip_id:"trip-2",dropoff_type:"station-to-station"},{id:"3",captain_id:"captain-3",captain_name:"Faisal R.",captain_rating:5,captain_phone:"+971509876543",departure_time:"16:45",estimated_price:40,trip_id:"trip-3",dropoff_type:"door-to-door"}]}}const C=new J;function ge(){const{user:P}=U(),[a,s]=o.useState("search"),[t,l]=o.useState("small"),[i,c]=o.useState(""),[n,D]=o.useState(""),[z,I]=o.useState([]),[x,L]=o.useState(null),[Z,T]=o.useState(!1),N=r=>{const R={dubai:{lat:25.2048,lng:55.2708},"abu dhabi":{lat:24.4539,lng:54.3773},riyadh:{lat:24.7136,lng:46.6753}},W=r.toLowerCase();return R[W]||{lat:25.2048,lng:55.2708}},M=async()=>{if(!i||!n){f.error("Please enter pickup and dropoff locations");return}T(!0);try{const r=await C.findAvailableCaptains(i,n,t);I(r),s("results")}catch(r){f.error(r.message||"Search failed")}finally{T(!1)}},q=r=>{L(r),s("details")},H=async()=>{if(!x||!P){f.error("Please sign in to book delivery");return}try{const r=await C.createDelivery({fromLocation:i,fromLat:N(i).lat,fromLng:N(i).lng,toLocation:n,toLat:N(n).lat,toLng:N(n).lng,packageSize:t,description:"Package delivery"});await C.assignCaptain(r.id,x.captain_id,x.estimated_price),f.success(`Delivery booked! Tracking code: ${r.tracking_code}`),s("search"),c(""),D(""),L(null)}catch(r){f.error(r.message||"Booking failed")}};return e.jsx("div",{className:"container mx-auto py-8 px-4 space-y-8 max-w-5xl",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start",children:[e.jsxs("div",{className:"flex-1 w-full space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Wassel Delivery"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Send packages securely with trusted Captains travelling your way."})]}),a==="search"&&e.jsxs(g,{className:"border-t-4 border-t-primary shadow-lg",children:[e.jsxs(w,{className:"bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-6 w-6 text-primary"}),"Ship a Package"]}),e.jsx(F,{children:"Choose pickup, dropoff, and package size for instant quotes."})]}),e.jsxs(j,{className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{className:"flex items-center gap-2 text-base",children:[e.jsx(y,{className:"h-4 w-4 text-primary"}),"Pickup Location"]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(v,{placeholder:"Enter city, district, or landmark",className:"pl-10 h-11 border-2 focus:border-primary transition-colors",value:i,onChange:r=>c(r.target.value)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Where should we collect the package?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{className:"flex items-center gap-2 text-base",children:[e.jsx(y,{className:"h-4 w-4 text-primary"}),"Dropoff Location"]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(v,{placeholder:"Enter destination address",className:"pl-10 h-11 border-2 focus:border-primary transition-colors",value:n,onChange:r=>D(r.target.value)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Where should we deliver it?"})]})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{className:"flex items-center gap-2 text-base",children:[e.jsx(G,{className:"h-4 w-4 text-primary"}),"Package Size"]}),e.jsxs(O,{value:t,onValueChange:r=>l(r),className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{value:"small",id:"small",className:"peer sr-only"}),e.jsxs(d,{htmlFor:"small",className:"flex flex-col items-center gap-3 rounded-xl border-2 border-muted bg-background p-5 hover:bg-accent hover:shadow-md cursor-pointer transition-all peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 peer-data-[state=checked]:shadow-md",children:[e.jsx(u,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Small"}),e.jsx(m,{variant:"outline",className:"text-xs",children:"Under 2kg"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Documents & keys"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{value:"medium",id:"medium",className:"peer sr-only"}),e.jsxs(d,{htmlFor:"medium",className:"flex flex-col items-center gap-3 rounded-xl border-2 border-muted bg-background p-5 hover:bg-accent hover:shadow-md cursor-pointer transition-all peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 peer-data-[state=checked]:shadow-md",children:[e.jsx(u,{className:"h-9 w-9 text-primary"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Medium"}),e.jsx(m,{variant:"outline",className:"text-xs",children:"2-18kg"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Boxes & bags"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{value:"large",id:"large",className:"peer sr-only"}),e.jsxs(d,{htmlFor:"large",className:"flex flex-col items-center gap-3 rounded-xl border-2 border-muted bg-background p-5 hover:bg-accent hover:shadow-md cursor-pointer transition-all peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 peer-data-[state=checked]:shadow-md",children:[e.jsx(E,{className:"h-10 w-10 text-primary"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Large"}),e.jsx(m,{variant:"outline",className:"text-xs",children:"Over 20kg"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Heavy items"})]})]})]})]})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{className:"flex items-center gap-2 text-base",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),"Preferred Delivery Date"]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"}),e.jsx(v,{type:"date",className:"pl-10 h-11 border-2 focus:border-primary transition-colors"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select when you need this delivered"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Why choose Wassel Delivery?"}),e.jsxs("ul",{className:"space-y-1 text-blue-800 dark:text-blue-200 text-xs",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"✓"}),e.jsx("span",{children:"Connect with verified Captains already traveling your route"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"✓"}),e.jsx("span",{children:"Save up to 60% compared to traditional courier services"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"✓"}),e.jsx("span",{children:"Track your package in real-time with photo confirmation"})]})]})]})]})}),e.jsxs(k,{size:"lg",className:"w-full h-12 text-base shadow-md hover:shadow-lg transition-all",onClick:M,children:[e.jsx(V,{className:"mr-2 h-5 w-5"})," Find Available Captains"]})]})]}),a==="results"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{variant:"ghost",onClick:()=>s("search"),className:"mb-2",children:"← Back to Search"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Available Captains"}),z.map(r=>e.jsx(g,{className:"hover:shadow-md transition-shadow",children:e.jsxs(j,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-lg",children:r.driver.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:r.driver}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx("span",{className:"text-yellow-500 mr-1",children:"★"})," ",r.rating,e.jsx("span",{className:"mx-2",children:"•"}),"Leaving at ",r.departureTime]}),e.jsx(m,{variant:"outline",className:"mt-1",children:r.dropoffType})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["AED ",r.price]}),e.jsx(k,{size:"sm",className:"mt-2",onClick:()=>q(r),children:"Book Delivery"})]})]})},r.id))]}),a==="details"&&x&&e.jsxs(g,{children:[e.jsx(w,{children:e.jsx(_,{children:"Confirm Delivery"})}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"From:"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"To:"}),e.jsx("span",{className:"font-medium",children:n})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Captain:"}),e.jsx("span",{className:"font-medium",children:x.driver})]}),e.jsx(p,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["AED ",x.price]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Package Contents Description"}),e.jsx(v,{placeholder:"e.g., Documents, Clothing, Spare parts..."})]}),e.jsx(k,{className:"w-full",size:"lg",onClick:H,children:"Confirm & Pay"})]})]})]}),e.jsxs("div",{className:"hidden md:block w-80 space-y-6",children:[e.jsx("div",{className:"rounded-xl overflow-hidden shadow-lg",children:e.jsx(Y,{src:"https://images.unsplash.com/photo-1645036828166-0b6a5f3f65ed?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwYWNrYWdlJTIwZGVsaXZlcnklMjBjYXIlMjB0cnVua3xlbnwxfHx8fDE3NjQ1NTYwMDB8MA&ixlib=rb-4.1.0&q=80&w=1080",alt:"Package Delivery",className:"w-full h-48 object-cover"})}),e.jsxs(g,{className:"border-2 border-primary/20 shadow-lg",children:[e.jsxs(w,{className:"bg-gradient-to-br from-primary/10 to-primary/5 pb-4",children:[e.jsxs(_,{className:"text-lg flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(X,{className:"h-5 w-5 text-primary"})}),"Transparent Pricing"]}),e.jsx(F,{className:"text-xs",children:"Fair rates based on package size and distance"})]}),e.jsxs(j,{className:"space-y-5 pt-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"font-semibold text-green-900 dark:text-green-100",children:"Small Package"})]}),e.jsx(m,{variant:"secondary",className:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-100",children:"Under 2kg"})]}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:"AED 15"}),e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400",children:"starting price"})]}),e.jsx("p",{className:"text-xs text-green-800 dark:text-green-200 leading-relaxed",children:"Perfect for documents, keys, phones, and small items"})]})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Medium Package"})]}),e.jsx(m,{variant:"secondary",className:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-100",children:"2-18kg"})]}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:"AED 35"}),e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:"starting price"})]}),e.jsx("p",{className:"text-xs text-blue-800 dark:text-blue-200 leading-relaxed",children:"Ideal for bags, boxes, small electronics, and gifts"})]})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-3 p-4 bg-purple-50 dark:bg-purple-950/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-7 w-7 text-purple-600 dark:text-purple-400"}),e.jsx("span",{className:"font-semibold text-purple-900 dark:text-purple-100",children:"Large Package"})]}),e.jsx(m,{variant:"secondary",className:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-100",children:"Over 20kg"})]}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-purple-700 dark:text-purple-300",children:"AED 60"}),e.jsx("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:"starting price"})]}),e.jsx("p",{className:"text-xs text-purple-800 dark:text-purple-200 leading-relaxed",children:"Great for heavy equipment, suitcases, and large items"})]})]}),e.jsx(p,{className:"my-4"}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-amber-900 dark:text-amber-100",children:"Price includes:"}),e.jsxs("ul",{className:"text-xs text-amber-800 dark:text-amber-200 space-y-0.5",children:[e.jsx("li",{children:"• Door-to-door delivery"}),e.jsx("li",{children:"• Insurance up to AED 5,000"}),e.jsx("li",{children:"• Real-time tracking"}),e.jsx("li",{children:"• Photo proof of delivery"})]})]})]})}),e.jsx("p",{className:"text-xs text-center text-muted-foreground italic pt-2",children:"Final price varies based on distance and route complexity"})]})]}),e.jsx(g,{className:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 border-green-200 dark:border-green-800",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/40 rounded-full",children:e.jsx($,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900 dark:text-green-100",children:"100% Secure"}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-300 mt-1",children:"All Captains are verified and packages are fully insured"})]})]})})})]})]})})}export{ge as PackageDelivery};
