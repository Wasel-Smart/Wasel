import{r as t,j as e}from"./vendor-ui-Cj-e85pn.js";import{u as W,s as S,B as l,C as N,a as L,b as P,d as R,e as y,f as q,t as i,R as $}from"./index-Dfmm_0fk.js";import{I as m}from"./input-C8BfD-fZ.js";import{L as c}from"./label-E-yG1832.js";import{S as z,a as V,b as G,c as U,d as x}from"./select-Dk-pQ3kL.js";import{P as Y}from"./plus-ByopEecX.js";import{C as E}from"./calendar-DnM3bZYU.js";import{M as I}from"./map-pin-CCHMR_wH.js";import{C as J}from"./clock-BVflGt2w.js";import{S as K}from"./square-pen-KR7LHjLJ.js";import{T as Q}from"./trash-2-BzGHQQ7Y.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-MHJ_mICC.js";import"./vendor-supabase-BfzcFBqZ.js";import"./vendor-animation-BozBRtxF.js";function me(){const{user:d}=W(),[b,M]=t.useState([]),[w,p]=t.useState(!1),[f,n]=t.useState(!1),[j,_]=t.useState(""),[g,T]=t.useState(""),[o,C]=t.useState(""),[u,D]=t.useState(""),[a,k]=t.useState("none");t.useEffect(()=>{d&&v()},[d]);const v=async()=>{n(!0);try{const{data:s,error:h}=await S.from("scheduled_trips").select("*").eq("user_id",d?.id).order("scheduled_date",{ascending:!0});if(h)throw h;const r=[{id:"1",from_location:"Dubai Marina",to_location:"Dubai Mall",scheduled_date:"2026-01-05",scheduled_time:"09:00",recurrence:"weekly",status:"scheduled",fare_estimate:45,created_at:new Date().toISOString()},{id:"2",from_location:"Home",to_location:"Office",scheduled_date:"2026-01-03",scheduled_time:"08:00",recurrence:"daily",status:"scheduled",fare_estimate:35,created_at:new Date().toISOString()}];M(s?.length?s:r)}catch(s){console.error("Failed to load scheduled trips:",s)}finally{n(!1)}},B=async s=>{if(s.preventDefault(),!j||!g||!o||!u){i.error("Please fill in all required fields");return}if(new Date(`${o}T${u}`)<=new Date){i.error("Scheduled time must be in the future");return}n(!0);try{const r=40+Math.random()*20,{error:F}=await S.from("scheduled_trips").insert({user_id:d?.id,from_location:j,to_location:g,scheduled_date:o,scheduled_time:u,recurrence:a,status:"scheduled",fare_estimate:r,created_at:new Date().toISOString()});if(F)throw F;i.success(a==="none"?"Trip scheduled successfully!":`Recurring trip scheduled (${a})`),_(""),T(""),C(""),D(""),k("none"),p(!1),v()}catch(r){console.error("Failed to schedule trip:",r),i.error("Failed to schedule trip")}finally{n(!1)}},O=async s=>{if(window.confirm("Are you sure you want to cancel this scheduled trip?"))try{const{error:r}=await S.from("scheduled_trips").update({status:"cancelled"}).eq("id",s);if(r)throw r;i.success("Scheduled trip cancelled"),v()}catch(r){console.error("Failed to cancel trip:",r),i.error("Failed to cancel trip")}},A=s=>s==="none"?null:e.jsxs(q,{variant:"outline",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),s]}),H=()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Scheduled Trips"}),e.jsx("p",{className:"text-muted-foreground",children:"Plan your trips in advance"})]}),!w&&e.jsxs(l,{onClick:()=>p(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Schedule Trip"]})]}),w&&e.jsxs(N,{className:"border-2 border-primary",children:[e.jsxs(L,{children:[e.jsx(P,{children:"Schedule a Trip"}),e.jsx(R,{children:"Book a trip for later or set up recurring trips"})]}),e.jsx(y,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"from",children:"Pickup Location *"}),e.jsx(m,{id:"from",value:j,onChange:s=>_(s.target.value),placeholder:"Enter pickup address",required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"to",children:"Dropoff Location *"}),e.jsx(m,{id:"to",value:g,onChange:s=>T(s.target.value),placeholder:"Enter destination address",required:!0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",children:"Date *"}),e.jsx(m,{id:"date",type:"date",value:o,onChange:s=>C(s.target.value),min:H(),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"time",children:"Time *"}),e.jsx(m,{id:"time",type:"time",value:u,onChange:s=>D(s.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recurrence",children:"Recurrence"}),e.jsxs(z,{value:a,onValueChange:s=>k(s),children:[e.jsx(V,{children:e.jsx(G,{})}),e.jsxs(U,{children:[e.jsx(x,{value:"none",children:"One-time trip"}),e.jsx(x,{value:"daily",children:"Daily"}),e.jsx(x,{value:"weekly",children:"Weekly"}),e.jsx(x,{value:"monthly",children:"Monthly"})]})]}),a!=="none"&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["This trip will repeat ",a]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:"Benefits of Scheduling"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("li",{children:"✓ Guaranteed driver availability"}),e.jsx("li",{children:"✓ Price lock - no surge pricing"}),e.jsx("li",{children:"✓ Priority matching"}),e.jsx("li",{children:"✓ Reminder notifications"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{type:"submit",disabled:f,className:"flex-1",children:f?"Scheduling...":"Schedule Trip"}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:f,children:"Cancel"})]})]})})]}),e.jsxs(N,{children:[e.jsxs(L,{children:[e.jsx(P,{children:"Upcoming Trips"}),e.jsx(R,{children:"Your scheduled and recurring trips"})]}),e.jsx(y,{children:b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No scheduled trips"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Schedule trips in advance for better planning"})]}):e.jsx("div",{className:"space-y-4",children:b.filter(s=>s.status==="scheduled").map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"default",children:"Scheduled"}),A(s.recurrence)]}),e.jsxs("span",{className:"font-semibold",children:["AED ",s.fare_estimate.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"From:"})," ",s.from_location]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"To:"})," ",s.to_location]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4"}),new Date(s.scheduled_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),s.scheduled_time]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>O(s.id),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]},s.id))})})]}),e.jsx(N,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:e.jsxs(y,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"How Scheduled Trips Work"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"1. Schedule your trip at least 2 hours in advance"}),e.jsx("li",{children:"2. We'll match you with a driver closer to your scheduled time"}),e.jsx("li",{children:"3. Receive notifications 30 minutes and 5 minutes before pickup"}),e.jsx("li",{children:"4. Cancel free of charge up to 1 hour before scheduled time"}),e.jsx("li",{children:"5. For recurring trips, each instance can be managed separately"})]})]})})]})}export{me as ScheduledTrips};
