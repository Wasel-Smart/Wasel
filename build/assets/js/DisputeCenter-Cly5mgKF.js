import{r,j as e}from"./vendor-ui-S1-b02vM.js";import{u as V,n as z,s as o,B as j,C as v,b as k,d as P,e as E,f as g,t as b,h as H}from"./index-C4myuZdd.js";import{I as O}from"./input-B6A87FZ6.js";import{T as Q}from"./textarea-Q3a7MXEa.js";import{S as W,a as G,b as J,c as K,d as i}from"./select-Dbr-udHW.js";import{L as d}from"./label-BRQac6GQ.js";import{F as q}from"./file-text-B6dr8E9y.js";import{C as L}from"./circle-check-big-DXrMOBon.js";import{C as M}from"./clock-DfBHxk1w.js";import{C as U}from"./circle-alert-X1n1Irhl.js";import"./vendor-react-7PqXWhc5.js";import"./vendor-utils-Drrw94dm.js";import"./vendor-supabase-DCWnlmhc.js";import"./vendor-animation-BozBRtxF.js";function pe(){const{user:a}=V(),{t:X}=z(),[y,A]=r.useState([]),[N,c]=r.useState(!1),[u,w]=r.useState(!1),[m,C]=r.useState(""),[p,D]=r.useState(""),[h,S]=r.useState(""),[x,F]=r.useState([]);r.useEffect(()=>{a&&I()},[a]);const I=async()=>{try{const{data:s,error:t}=await o.from("disputes").select("*").eq("filed_by",a?.id).order("created_at",{ascending:!1});if(t)throw t;A(s||[])}catch(s){console.error("Failed to load disputes:",s)}},B=async s=>{if(s.preventDefault(),!m||!p||!h){b.error("Please fill in all required fields");return}w(!0);try{const t=[];for(const n of x){const f=`${a?.id}/${Date.now()}_${n.name}`,{data:T,error:_}=await o.storage.from("dispute-evidence").upload(f,n);if(_)throw _;if(T){const{data:{publicUrl:$}}=o.storage.from("dispute-evidence").getPublicUrl(T.path);t.push($)}}const{error:l}=await o.from("disputes").insert({trip_id:m,filed_by:a?.id,type:p,description:h,evidence:t,status:"open",created_at:new Date().toISOString()});if(l)throw l;b.success("Dispute filed successfully. Our team will review it within 24 hours."),C(""),D(""),S(""),F([]),c(!1),I()}catch(t){console.error("Failed to file dispute:",t),b.error("Failed to file dispute. Please try again.")}finally{w(!1)}},R=s=>{s.target.files&&F(Array.from(s.target.files))},Y=s=>{const t={open:{variant:"destructive",label:"Open",icon:U},under_review:{variant:"secondary",label:"Under Review",icon:M},resolved:{variant:"default",label:"Resolved",icon:L},closed:{variant:"outline",label:"Closed",icon:L}},{variant:l,label:n,icon:f}=t[s]||{variant:"outline",label:s,icon:U};return e.jsxs(H,{variant:l,children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),n]})};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dispute Center"}),e.jsx("p",{className:"text-muted-foreground",children:"File and track disputes for your trips"})]}),!N&&e.jsxs(j,{onClick:()=>c(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"File New Dispute"]})]}),N&&e.jsxs(v,{className:"border-2 border-primary",children:[e.jsxs(k,{children:[e.jsx(P,{children:"File a Dispute"}),e.jsx(E,{children:"Provide details about your issue. Our team will review within 24 hours."})]}),e.jsx(g,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"tripId",children:"Trip ID *"}),e.jsx(O,{id:"tripId",value:m,onChange:s=>C(s.target.value),placeholder:"Enter trip ID (found in trip history)",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"disputeType",children:"Dispute Type *"}),e.jsxs(W,{value:p,onValueChange:D,required:!0,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select dispute type"})}),e.jsxs(K,{children:[e.jsx(i,{value:"pricing",children:"Pricing Issue"}),e.jsx(i,{value:"service",children:"Service Quality"}),e.jsx(i,{value:"safety",children:"Safety Concern"}),e.jsx(i,{value:"lost_item",children:"Lost Item"}),e.jsx(i,{value:"payment",children:"Payment Problem"}),e.jsx(i,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description *"}),e.jsx(Q,{id:"description",value:h,onChange:s=>S(s.target.value),placeholder:"Describe the issue in detail...",rows:6,required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"evidence",children:"Evidence (optional)"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(O,{id:"evidence",type:"file",multiple:!0,accept:"image/*,.pdf",onChange:R}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Upload screenshots, receipts, or other supporting documents"}),x.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:x.map((s,t)=>e.jsxs("p",{className:"text-sm text-muted-foreground",children:["‚úì ",s.name]},t))})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{type:"submit",disabled:u,className:"flex-1",children:u?"Submitting...":"Submit Dispute"}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>c(!1),disabled:u,children:"Cancel"})]})]})})]}),e.jsxs(v,{children:[e.jsxs(k,{children:[e.jsx(P,{children:"Your Disputes"}),e.jsx(E,{children:"Track the status of your filed disputes"})]}),e.jsx(g,{children:y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No disputes filed"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"If you have an issue with a trip, you can file a dispute above"})]}):e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Y(s.status),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Trip ID: ",s.trip_id.slice(0,8)]})]}),e.jsxs("p",{className:"font-semibold capitalize",children:[s.type.replace("_"," ")," Issue"]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),s.resolution&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-950 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:"Resolution:"}),e.jsx("p",{className:"text-sm",children:s.resolution})]}),s.status==="open"&&e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"‚è±Ô∏è Your dispute is in queue. Average response time: 24 hours"}),s.status==="under_review"&&e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"üîç Our team is reviewing your case. You'll be notified soon."})]},s.id))})})]}),e.jsx(v,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Dispute Resolution Process"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"1. Submit your dispute with detailed information"}),e.jsx("li",{children:"2. Our team reviews your case within 24 hours"}),e.jsx("li",{children:"3. We may contact you for additional information"}),e.jsx("li",{children:"4. A resolution is provided within 2-3 business days"}),e.jsx("li",{children:"5. If applicable, refunds are processed to your original payment method"})]})]})})]})}export{pe as DisputeCenter};
